<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
%>

<%page args="course_overview, enrollment, show_courseware_link, cert_status, can_unenroll, credit_status, show_email_settings, course_mode_info, show_refund_option, is_paid_course, is_course_blocked, verification_status, course_requirements, dashboard_index, user, course_program_info" />


<%
  if is_course_blocked:
    course_target = "#"
    blocked_class = "blocked"
  else:
    course_target = reverse('info', args=[unicode(course_overview.id)])
    blocked_class = ""
  endif
%>

<li class="a--dashboard-course-listing-01">
  <article class="a--dashboard-course-listing-01__container ${blocked_class}">
    <a
      % if show_courseware_link:
        href="${course_target}"
      % endif
      data-course-key="${enrollment.course_id}" class="a--dashboard-course-listing-01__course-image" style="background-image: url('${course_overview.course_image_url}');" alt="${_('{course_number} {course_name} Home Page').format(course_number=course_overview.number, course_name=course_overview.display_name_with_default) |h}">
      % if is_course_blocked:
        <span class="course-blocked-overlay"></span>
        <span class="course-blocked-label">Blocked</span>
      % endif
    </a>
    <div class="a--dashboard-course-listing-01__details-wrapper">
      <div class="a--dashboard-course-listing-01__details-container">
        <!-- course title -->
        % if show_courseware_link:
          <a
            % if not is_course_blocked:
              href="${course_target}"
            % endif
            class="a--dashboard-course-listing-01__course-name">
              ${course_overview.display_name_with_default}
            </a>
        % else:
          <h2 class="a--dashboard-course-listing-01__course-name">
            ${course_overview.display_name_with_default}
          </h2>
        % endif
        <!-- course-organisation -->
        <h4 class="a--dashboard-course-listing-01__course-organisation-id">
          ${course_overview.display_org_with_default | h} - <span>${course_overview.display_number_with_default | h}</span>
        </h4>
        <!-- course dates -->
        <div class="a--dashboard-course-listing-01__course-dates">
          % if course_overview.has_ended():
            <span class="course-ended">${_("Ended - {end_date}").format(end_date=course_overview.end_datetime_text("SHORT_DATE"))}</span>
          % elif course_overview.has_started():
            <span class="course-started">${_("Started - {start_date}").format(start_date=course_overview.start_datetime_text("SHORT_DATE"))}</span>
          % elif course_overview.start_date_is_still_default: # Course start date TBD
            <span class="course-coming-soon">${_("Coming Soon")}</span>
          % elif course_overview.starts_within(days=5):   # hasn't started yet
            <span class="course-starts-soon">${_("Starts - {start_date}").format(start_date=course_overview.start_datetime_text("DAY_AND_TIME"))}</span>
          % else:   # hasn't started yet
            <span class="course-starts">${_("Starts - {start_date}").format(start_date=course_overview.start_datetime_text("SHORT_DATE"))}</span>
          % endif
        </div>
        <!-- course options -->
        <ul class="a--dashboard-course-listing-01__course-options actions-dropdown-list" id="actions-dropdown-list-${dashboard_index}">
          <li class="actions-item" id="actions-item-unenroll-${dashboard_index}">
            % if is_paid_course and show_refund_option:
              % if not is_course_blocked:
                <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % else:
                <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % endif
            % elif is_paid_course and not show_refund_option:
              % if not is_course_blocked:
                <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will not be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % else:
                <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will not be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % endif
            % elif enrollment.mode != "verified":
              % if not is_course_blocked:
                <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?") | h}">${_('Unenroll')}</a>
              % else:
                <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?") | h}">${_('Unenroll')}</a>
              % endif
            % elif show_refund_option:
              % if not is_course_blocked:
                <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long | h}" data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % else:
                <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long | h}" data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("You will be refunded the amount you paid.") | h}">${_('Unenroll')}</a>
              % endif
              % else:
                % if not is_course_blocked:
                  <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long | h}" data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.") | h}">${_('Unenroll')}</a>
                % else:
                  <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-course-name="${course_overview.display_name_with_default | h}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long | h}" data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?") | h}" data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.") | h}">${_('Unenroll')}</a>
                % endif
              % endif
          </li>
          <li class="actions-item" id="actions-item-email-settings-${dashboard_index}">
            % if show_email_settings:
              % if not is_course_blocked:
                <a href="#email-settings-modal" class="action action-email-settings" rel="leanModal" data-course-id="${course_overview.id | h}" data-course-number="${course_overview.number | h}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
              % else:
                <a class="action action-email-settings is-disabled" data-course-id="${course_overview.id| h}" data-course-number="${course_overview.number | h}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
              % endif
            % endif
          </li>
        </ul>
      </div>
    </div>
    <div class="a--dashboard-course-listing-01__courseware-link">
      % if not is_course_blocked:
        <a href="${course_target}"><i class="fa fa-angle-double-right"></i></a>
      % endif
    </div>
  </article>
  <script>
    $( document ).ready(function() {
      if("${is_course_blocked}" == "True"){
        $( "#unregister_block_course" ).click(function() {
          $('.disable-look-unregister').click();
        });
      }
    });
  </script>
</li>
